<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="referrer" content="never">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="style.css">
    <script src="https://at.alicdn.com/t/font_1134913_4tzkislrxwm.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <title>MY FM</title>
</head>

<body>
    <section id="page-main">
        <main class="main">
            <div class="left">
                <figure></figure>
                <ul class="buttons">
                    <li class="like" id="like">
                        <svg class="icon icon1" aria-hidden="true">
                            <use xlink:href="#icon-like"></use>
                        </svg>
                    </li>
                    <li class="like" id="pause">
                        <svg class="icon icon1" aria-hidden="true">
                            <use xlink:href="#icon-pause-circle-outline"></use>
                        </svg>
                    </li>
                    <li class="like" id="play">
                        <svg class="icon icon1" aria-hidden="true">
                            <use xlink:href="#icon-pause-circle-outline"></use>
                        </svg>
                    </li>
                    <li class="like" id="nextsong">
                        <svg class="icon icon1" aria-hidden="true">
                            <use xlink:href="#icon-next-song"></use>
                        </svg>
                    </li>
                </ul>
            </div>
            <div class="right">
                <div class="top">
                    <div class="term">频道名</div>
                    <div class="song">歌名</div>
                </div>
                <ul class="middle">
                    <li>
                        <svg class="icon icon2" aria-hidden="true">
                            <use xlink:href="#icon-listen1"></use>
                        </svg>
                        <span>播放数</span>
                    </li>
                    <li>
                        <svg class="icon icon2" aria-hidden="true">
                            <use xlink:href="#icon-like2"></use>
                        </svg>
                        <span>喜欢书</span>
                    </li>
                    <li>
                        <svg class="icon icon2" aria-hidden="true">
                            <use xlink:href="#icon-like4"></use>
                        </svg>
                        <span>点赞数</span>
                    </li>
                </ul>
                <div class="bottom">
                    <div class="bar">
                        <div class="bar-progress"></div>
                        <div class="long" id="songduration">1:20</div>
                    </div>
                    <div class="singer">歌手</div>
                </div>
            </div>
            </div>
        </main>
        <footer>
            <div class="layout">
                <div class="iconleft" id="footerLast">
                    <svg class="icon icon1 icon3" aria-hidden="true">
                        <use xlink:href="#icon-left"></use>
                    </svg>
                </div>
                <div class="iconright" id="footerNext">
                    <svg class="icon icon1 icon3" aria-hidden="true">
                        <use xlink:href="#icon-right"></use>
                    </svg>
                </div>
                <div class="box" id="channelList">
                    <ul>
                    </ul>
                </div>
            </div>
        </footer>
    </section>
    <section id="page-cover"></section>
    <div class="bg">jk</div>
</body>
<script>
    var EventCenter = {
        on: function (type, handler) {
            $(document).on(type, handler)
        },
        fire: function (type, data) {
            $(document).trigger(type, data)
        }
    }


    var fm = {
        init: function () {
            this.audioObject = new Audio()
            this.audioObject.autoplay = true
            this.audioObject.volume = 0.2
            this.duration = 0
            this.currentTime = 0
            this.bind()
        },
        bind: function () {
            var _this = this


            EventCenter.on('selectChannel', (e, data) => {
                // console.log('selectChannel')
                // console.log(data)
                _this.channelId = data.channelId
                $('.term').text(data.channelName)
                _this.loadmusic()
                // console.log(_this.currentTime)
            })

             $('main .left #pause').on('click', () => {
                this.audioObject.pause()
                // $('main .left #pause svg > use').attr('xlink:href', 'icon-play-circle-outline')
                //     $('main .left #play').css('display', 'block')
                // }, 100)
            })
        },
        loadmusic: function () {
            var _this = this
            console.log(_this)
            $.getJSON('http://api.jirengu.com/fm/getSong.php', { channel: _this.channelId }).done((data1) => {
                console.log(data1)
                $('.bg').css('background-image', 'url(' + data1.song[0].picture + ')')
                $('main .left > figure').css('background-image', `url(` + data1.song[0].picture + `)`)
                $('.singer').text(data1.song[0].artist)
                $('.song').text(data1.song[0].title)
                var url = data1.song[0].url
                _this.audioObject.src = url
                _this.audioObject.addEventListener('playing', function (e) {
                    _this.duration = _this.audioObject.duration
                })

                $('songduration').text(_this.audioObject.duration)
            }).then(() => {
                currenttime = setInterval(() => {
                    _this.currentTime = _this.audioObject.currentTime + 1
                    console.log(parseInt(_this.currentTime))
                    window.clearInterval('currenttime')
                }, 1010)
            })
        }
    }


    var footer = {
        init: function () {
            this.$footer = $('footer')
            this.render()
        },
        bind: function (data) {
            var itemwidth = $('#channelList ul').find('li').outerWidth(true)
            var count = parseInt($('.box').width() / itemwidth)
            var x = itemwidth * count

            //footernext()
            $('footer #footerNext').on('click', () => {
                if (parseInt($('#channelList > ul').css('left')) > -5367) {
                    $('#channelList > ul').css('left', '-=' + x).addClass('tsfX')
                }
            })
            // footerlast()
            $('footer #footerLast').on('click', () => {
                if (parseInt($('#channelList > ul').css('left')) < 0) {
                    $('#channelList > ul').css('left', '+=' + x).addClass('tsfX')
                }
            })
            this.$footer.on('click', 'li', function () {
                console.log(this)
                $(this).addClass('active')
                    .siblings().removeClass('active')
                EventCenter.fire('selectChannel', {  //jquery中用attr()方法来获取和设置元素属性
                    channelId: $(this).find('div').attr('id'),
                    channelName: $(this).find('h3').text()
                })
            })

        },
        render: function (channels) {
            $.getJSON('http://api.jirengu.com/fm/getChannels.php').done((data1) => {
                // console.log(data1.channels)
                let list = $('#channelList h3')
                var length = data1.channels.length
                var i
                for (i = 0; i < length; i++) {
                    var str = `<li>
                            <div class="cover" id="`+ data1.channels[i].channel_id + `" style="background-image:url(` + data1.channels[i].cover_small + `)"></div>
                            <h3>`+ data1.channels[i].name + `</h3>
                        </li>`
                    $('footer ul').append(str)
                }
            }).then((data1) => {
                this.bind(data1)
            })
        }
    }
    fm.init()
    footer.init()
</script>

</html>